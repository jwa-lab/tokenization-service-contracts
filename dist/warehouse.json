{
    "contractName": "Warehouse",
    "michelson": [
        {
            "prim": "parameter",
            "args": [
                {
                    "prim": "or",
                    "args": [
                        {
                            "prim": "or",
                            "args": [
                                {
                                    "prim": "pair",
                                    "args": [
                                        {
                                            "prim": "pair",
                                            "args": [
                                                {
                                                    "prim": "pair",
                                                    "args": [
                                                        {
                                                            "prim": "nat",
                                                            "annots": [
                                                                "%available_quantity"
                                                            ]
                                                        },
                                                        {
                                                            "prim": "map",
                                                            "args": [
                                                                {
                                                                    "prim": "string"
                                                                },
                                                                {
                                                                    "prim": "string"
                                                                }
                                                            ],
                                                            "annots": ["%data"]
                                                        }
                                                    ]
                                                },
                                                {
                                                    "prim": "pair",
                                                    "args": [
                                                        {
                                                            "prim": "nat",
                                                            "annots": [
                                                                "%item_id"
                                                            ]
                                                        },
                                                        {
                                                            "prim": "string",
                                                            "annots": ["%name"]
                                                        }
                                                    ]
                                                }
                                            ]
                                        },
                                        {
                                            "prim": "pair",
                                            "args": [
                                                {
                                                    "prim": "option",
                                                    "args": [
                                                        { "prim": "timestamp" }
                                                    ],
                                                    "annots": [
                                                        "%no_update_after"
                                                    ]
                                                },
                                                {
                                                    "prim": "nat",
                                                    "annots": [
                                                        "%total_quantity"
                                                    ]
                                                }
                                            ]
                                        }
                                    ],
                                    "annots": ["%add_item"]
                                },
                                {
                                    "prim": "pair",
                                    "args": [
                                        {
                                            "prim": "pair",
                                            "args": [
                                                { "prim": "address" },
                                                { "prim": "nat" }
                                            ]
                                        },
                                        { "prim": "nat" }
                                    ],
                                    "annots": ["%assign_item_proxy"]
                                }
                            ]
                        },
                        {
                            "prim": "or",
                            "args": [
                                { "prim": "nat", "annots": ["%freeze_item"] },
                                {
                                    "prim": "pair",
                                    "args": [
                                        {
                                            "prim": "pair",
                                            "args": [
                                                {
                                                    "prim": "pair",
                                                    "args": [
                                                        {
                                                            "prim": "nat",
                                                            "annots": [
                                                                "%available_quantity"
                                                            ]
                                                        },
                                                        {
                                                            "prim": "map",
                                                            "args": [
                                                                {
                                                                    "prim": "string"
                                                                },
                                                                {
                                                                    "prim": "string"
                                                                }
                                                            ],
                                                            "annots": ["%data"]
                                                        }
                                                    ]
                                                },
                                                {
                                                    "prim": "pair",
                                                    "args": [
                                                        {
                                                            "prim": "nat",
                                                            "annots": [
                                                                "%item_id"
                                                            ]
                                                        },
                                                        {
                                                            "prim": "string",
                                                            "annots": ["%name"]
                                                        }
                                                    ]
                                                }
                                            ]
                                        },
                                        {
                                            "prim": "pair",
                                            "args": [
                                                {
                                                    "prim": "option",
                                                    "args": [
                                                        { "prim": "timestamp" }
                                                    ],
                                                    "annots": [
                                                        "%no_update_after"
                                                    ]
                                                },
                                                {
                                                    "prim": "nat",
                                                    "annots": [
                                                        "%total_quantity"
                                                    ]
                                                }
                                            ]
                                        }
                                    ],
                                    "annots": ["%update_item"]
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "prim": "storage",
            "args": [
                {
                    "prim": "pair",
                    "args": [
                        {
                            "prim": "pair",
                            "args": [
                                { "prim": "address", "annots": ["%owner"] },
                                { "prim": "string", "annots": ["%version"] }
                            ]
                        },
                        {
                            "prim": "big_map",
                            "args": [
                                { "prim": "nat" },
                                {
                                    "prim": "pair",
                                    "args": [
                                        {
                                            "prim": "pair",
                                            "args": [
                                                {
                                                    "prim": "pair",
                                                    "args": [
                                                        {
                                                            "prim": "nat",
                                                            "annots": [
                                                                "%available_quantity"
                                                            ]
                                                        },
                                                        {
                                                            "prim": "map",
                                                            "args": [
                                                                {
                                                                    "prim": "string"
                                                                },
                                                                {
                                                                    "prim": "string"
                                                                }
                                                            ],
                                                            "annots": ["%data"]
                                                        }
                                                    ]
                                                },
                                                {
                                                    "prim": "pair",
                                                    "args": [
                                                        {
                                                            "prim": "nat",
                                                            "annots": [
                                                                "%item_id"
                                                            ]
                                                        },
                                                        {
                                                            "prim": "string",
                                                            "annots": ["%name"]
                                                        }
                                                    ]
                                                }
                                            ]
                                        },
                                        {
                                            "prim": "pair",
                                            "args": [
                                                {
                                                    "prim": "option",
                                                    "args": [
                                                        { "prim": "timestamp" }
                                                    ],
                                                    "annots": [
                                                        "%no_update_after"
                                                    ]
                                                },
                                                {
                                                    "prim": "nat",
                                                    "annots": [
                                                        "%total_quantity"
                                                    ]
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ],
                            "annots": ["%warehouse"]
                        }
                    ]
                }
            ]
        },
        {
            "prim": "code",
            "args": [
                [
                    { "prim": "UNPAIR" },
                    {
                        "prim": "IF_LEFT",
                        "args": [
                            [
                                {
                                    "prim": "IF_LEFT",
                                    "args": [
                                        [
                                            { "prim": "SWAP" },
                                            { "prim": "DUP" },
                                            {
                                                "prim": "DUG",
                                                "args": [{ "int": "2" }]
                                            },
                                            { "prim": "CDR" },
                                            { "prim": "SWAP" },
                                            { "prim": "DUP" },
                                            {
                                                "prim": "DUG",
                                                "args": [{ "int": "2" }]
                                            },
                                            { "prim": "CAR" },
                                            { "prim": "CDR" },
                                            { "prim": "CAR" },
                                            { "prim": "GET" },
                                            {
                                                "prim": "IF_NONE",
                                                "args": [
                                                    [
                                                        { "prim": "SWAP" },
                                                        { "prim": "DUP" },
                                                        {
                                                            "prim": "DUG",
                                                            "args": [
                                                                { "int": "2" }
                                                            ]
                                                        },
                                                        { "prim": "CDR" },
                                                        { "prim": "SWAP" },
                                                        { "prim": "DUP" },
                                                        { "prim": "CAR" },
                                                        { "prim": "CDR" },
                                                        { "prim": "CAR" },
                                                        { "prim": "SWAP" },
                                                        { "prim": "SOME" },
                                                        { "prim": "SWAP" },
                                                        { "prim": "UPDATE" },
                                                        { "prim": "SWAP" },
                                                        { "prim": "CAR" },
                                                        { "prim": "PAIR" }
                                                    ],
                                                    [
                                                        {
                                                            "prim": "DROP",
                                                            "args": [
                                                                { "int": "2" }
                                                            ]
                                                        },
                                                        {
                                                            "prim": "PUSH",
                                                            "args": [
                                                                {
                                                                    "prim": "string"
                                                                },
                                                                {
                                                                    "string": "ITEM_ID_ALREADY_EXISTS"
                                                                }
                                                            ]
                                                        },
                                                        { "prim": "FAILWITH" }
                                                    ]
                                                ]
                                            },
                                            {
                                                "prim": "NIL",
                                                "args": [
                                                    { "prim": "operation" }
                                                ]
                                            },
                                            { "prim": "PAIR" }
                                        ],
                                        [
                                            {
                                                "prim": "NIL",
                                                "args": [
                                                    { "prim": "operation" }
                                                ]
                                            },
                                            {
                                                "prim": "DUP",
                                                "args": [{ "int": "3" }]
                                            },
                                            { "prim": "CDR" },
                                            {
                                                "prim": "DUP",
                                                "args": [{ "int": "3" }]
                                            },
                                            { "prim": "CAR" },
                                            { "prim": "CDR" },
                                            { "prim": "GET" },
                                            {
                                                "prim": "IF_NONE",
                                                "args": [
                                                    [
                                                        { "prim": "SWAP" },
                                                        { "prim": "DROP" },
                                                        {
                                                            "prim": "PUSH",
                                                            "args": [
                                                                {
                                                                    "prim": "string"
                                                                },
                                                                {
                                                                    "string": "ITEM_DOESNT_EXIST"
                                                                }
                                                            ]
                                                        },
                                                        { "prim": "FAILWITH" }
                                                    ],
                                                    [
                                                        { "prim": "DUP" },
                                                        { "prim": "CDR" },
                                                        { "prim": "CDR" },
                                                        {
                                                            "prim": "DUP",
                                                            "args": [
                                                                { "int": "4" }
                                                            ]
                                                        },
                                                        { "prim": "CDR" },
                                                        { "prim": "COMPARE" },
                                                        { "prim": "GT" },
                                                        {
                                                            "prim": "PUSH",
                                                            "args": [
                                                                {
                                                                    "prim": "nat"
                                                                },
                                                                { "int": "0" }
                                                            ]
                                                        },
                                                        {
                                                            "prim": "DUP",
                                                            "args": [
                                                                { "int": "3" }
                                                            ]
                                                        },
                                                        { "prim": "CAR" },
                                                        { "prim": "CAR" },
                                                        { "prim": "CAR" },
                                                        { "prim": "COMPARE" },
                                                        { "prim": "EQ" },
                                                        { "prim": "OR" },
                                                        {
                                                            "prim": "IF",
                                                            "args": [
                                                                [
                                                                    {
                                                                        "prim": "DROP"
                                                                    },
                                                                    {
                                                                        "prim": "SWAP"
                                                                    },
                                                                    {
                                                                        "prim": "DROP"
                                                                    },
                                                                    {
                                                                        "prim": "PUSH",
                                                                        "args": [
                                                                            {
                                                                                "prim": "string"
                                                                            },
                                                                            {
                                                                                "string": "NO_AVAILABLE_ITEM"
                                                                            }
                                                                        ]
                                                                    },
                                                                    {
                                                                        "prim": "FAILWITH"
                                                                    }
                                                                ],
                                                                [
                                                                    {
                                                                        "prim": "SWAP"
                                                                    },
                                                                    {
                                                                        "prim": "DROP"
                                                                    },
                                                                    {
                                                                        "prim": "SWAP"
                                                                    },
                                                                    {
                                                                        "prim": "DUP"
                                                                    },
                                                                    {
                                                                        "prim": "DUG",
                                                                        "args": [
                                                                            {
                                                                                "int": "2"
                                                                            }
                                                                        ]
                                                                    },
                                                                    {
                                                                        "prim": "CAR"
                                                                    },
                                                                    {
                                                                        "prim": "CAR"
                                                                    },
                                                                    {
                                                                        "prim": "CONTRACT",
                                                                        "args": [
                                                                            {
                                                                                "prim": "pair",
                                                                                "args": [
                                                                                    {
                                                                                        "prim": "pair",
                                                                                        "args": [
                                                                                            {
                                                                                                "prim": "map",
                                                                                                "args": [
                                                                                                    {
                                                                                                        "prim": "string"
                                                                                                    },
                                                                                                    {
                                                                                                        "prim": "string"
                                                                                                    }
                                                                                                ],
                                                                                                "annots": [
                                                                                                    "%data"
                                                                                                ]
                                                                                            },
                                                                                            {
                                                                                                "prim": "nat",
                                                                                                "annots": [
                                                                                                    "%instance_number"
                                                                                                ]
                                                                                            }
                                                                                        ]
                                                                                    },
                                                                                    {
                                                                                        "prim": "nat",
                                                                                        "annots": [
                                                                                            "%item_id"
                                                                                        ]
                                                                                    }
                                                                                ]
                                                                            }
                                                                        ],
                                                                        "annots": [
                                                                            "%assign_item"
                                                                        ]
                                                                    },
                                                                    {
                                                                        "prim": "IF_NONE",
                                                                        "args": [
                                                                            [
                                                                                {
                                                                                    "prim": "PUSH",
                                                                                    "args": [
                                                                                        {
                                                                                            "prim": "string"
                                                                                        },
                                                                                        {
                                                                                            "string": "CONTRACT_NOT_FOUND"
                                                                                        }
                                                                                    ]
                                                                                },
                                                                                {
                                                                                    "prim": "FAILWITH"
                                                                                }
                                                                            ],
                                                                            []
                                                                        ]
                                                                    },
                                                                    {
                                                                        "prim": "PUSH",
                                                                        "args": [
                                                                            {
                                                                                "prim": "mutez"
                                                                            },
                                                                            {
                                                                                "int": "0"
                                                                            }
                                                                        ]
                                                                    },
                                                                    {
                                                                        "prim": "DUP",
                                                                        "args": [
                                                                            {
                                                                                "int": "4"
                                                                            }
                                                                        ]
                                                                    },
                                                                    {
                                                                        "prim": "CAR"
                                                                    },
                                                                    {
                                                                        "prim": "CDR"
                                                                    },
                                                                    {
                                                                        "prim": "DUP",
                                                                        "args": [
                                                                            {
                                                                                "int": "5"
                                                                            }
                                                                        ]
                                                                    },
                                                                    {
                                                                        "prim": "CDR"
                                                                    },
                                                                    {
                                                                        "prim": "DUP",
                                                                        "args": [
                                                                            {
                                                                                "int": "5"
                                                                            }
                                                                        ]
                                                                    },
                                                                    {
                                                                        "prim": "CAR"
                                                                    },
                                                                    {
                                                                        "prim": "CAR"
                                                                    },
                                                                    {
                                                                        "prim": "CDR"
                                                                    },
                                                                    {
                                                                        "prim": "PAIR"
                                                                    },
                                                                    {
                                                                        "prim": "PAIR"
                                                                    },
                                                                    {
                                                                        "prim": "TRANSFER_TOKENS"
                                                                    },
                                                                    {
                                                                        "prim": "SWAP"
                                                                    },
                                                                    {
                                                                        "prim": "DUP"
                                                                    },
                                                                    {
                                                                        "prim": "DUG",
                                                                        "args": [
                                                                            {
                                                                                "int": "2"
                                                                            }
                                                                        ]
                                                                    },
                                                                    {
                                                                        "prim": "CDR"
                                                                    },
                                                                    {
                                                                        "prim": "DUP",
                                                                        "args": [
                                                                            {
                                                                                "int": "3"
                                                                            }
                                                                        ]
                                                                    },
                                                                    {
                                                                        "prim": "CAR"
                                                                    },
                                                                    {
                                                                        "prim": "CDR"
                                                                    },
                                                                    {
                                                                        "prim": "DUP",
                                                                        "args": [
                                                                            {
                                                                                "int": "4"
                                                                            }
                                                                        ]
                                                                    },
                                                                    {
                                                                        "prim": "CAR"
                                                                    },
                                                                    {
                                                                        "prim": "CAR"
                                                                    },
                                                                    {
                                                                        "prim": "CDR"
                                                                    },
                                                                    {
                                                                        "prim": "PUSH",
                                                                        "args": [
                                                                            {
                                                                                "prim": "nat"
                                                                            },
                                                                            {
                                                                                "int": "1"
                                                                            }
                                                                        ]
                                                                    },
                                                                    {
                                                                        "prim": "DIG",
                                                                        "args": [
                                                                            {
                                                                                "int": "5"
                                                                            }
                                                                        ]
                                                                    },
                                                                    {
                                                                        "prim": "CAR"
                                                                    },
                                                                    {
                                                                        "prim": "CAR"
                                                                    },
                                                                    {
                                                                        "prim": "CAR"
                                                                    },
                                                                    {
                                                                        "prim": "SUB"
                                                                    },
                                                                    {
                                                                        "prim": "ABS"
                                                                    },
                                                                    {
                                                                        "prim": "PAIR"
                                                                    },
                                                                    {
                                                                        "prim": "PAIR"
                                                                    },
                                                                    {
                                                                        "prim": "PAIR"
                                                                    },
                                                                    {
                                                                        "prim": "DUP",
                                                                        "args": [
                                                                            {
                                                                                "int": "4"
                                                                            }
                                                                        ]
                                                                    },
                                                                    {
                                                                        "prim": "CDR"
                                                                    },
                                                                    {
                                                                        "prim": "SWAP"
                                                                    },
                                                                    {
                                                                        "prim": "DIG",
                                                                        "args": [
                                                                            {
                                                                                "int": "3"
                                                                            }
                                                                        ]
                                                                    },
                                                                    {
                                                                        "prim": "CAR"
                                                                    },
                                                                    {
                                                                        "prim": "CDR"
                                                                    },
                                                                    {
                                                                        "prim": "SWAP"
                                                                    },
                                                                    {
                                                                        "prim": "SOME"
                                                                    },
                                                                    {
                                                                        "prim": "SWAP"
                                                                    },
                                                                    {
                                                                        "prim": "UPDATE"
                                                                    },
                                                                    {
                                                                        "prim": "DIG",
                                                                        "args": [
                                                                            {
                                                                                "int": "2"
                                                                            }
                                                                        ]
                                                                    },
                                                                    {
                                                                        "prim": "CAR"
                                                                    },
                                                                    {
                                                                        "prim": "PAIR"
                                                                    },
                                                                    {
                                                                        "prim": "NIL",
                                                                        "args": [
                                                                            {
                                                                                "prim": "operation"
                                                                            }
                                                                        ]
                                                                    },
                                                                    {
                                                                        "prim": "DIG",
                                                                        "args": [
                                                                            {
                                                                                "int": "2"
                                                                            }
                                                                        ]
                                                                    },
                                                                    {
                                                                        "prim": "CONS"
                                                                    },
                                                                    {
                                                                        "prim": "PAIR"
                                                                    }
                                                                ]
                                                            ]
                                                        }
                                                    ]
                                                ]
                                            }
                                        ]
                                    ]
                                }
                            ],
                            [
                                {
                                    "prim": "IF_LEFT",
                                    "args": [
                                        [
                                            { "prim": "SWAP" },
                                            { "prim": "DUP" },
                                            {
                                                "prim": "DUG",
                                                "args": [{ "int": "2" }]
                                            },
                                            { "prim": "CDR" },
                                            { "prim": "SWAP" },
                                            { "prim": "GET" },
                                            {
                                                "prim": "IF_NONE",
                                                "args": [
                                                    [
                                                        {
                                                            "prim": "PUSH",
                                                            "args": [
                                                                {
                                                                    "prim": "string"
                                                                },
                                                                {
                                                                    "string": "ITEM_ID_DOESNT_EXIST"
                                                                }
                                                            ]
                                                        },
                                                        { "prim": "FAILWITH" }
                                                    ],
                                                    [
                                                        { "prim": "DUP" },
                                                        { "prim": "CDR" },
                                                        { "prim": "CAR" },
                                                        {
                                                            "prim": "IF_NONE",
                                                            "args": [
                                                                [
                                                                    {
                                                                        "prim": "PUSH",
                                                                        "args": [
                                                                            {
                                                                                "prim": "unit"
                                                                            },
                                                                            {
                                                                                "prim": "Unit"
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                [
                                                                    {
                                                                        "prim": "NOW"
                                                                    },
                                                                    {
                                                                        "prim": "COMPARE"
                                                                    },
                                                                    {
                                                                        "prim": "GE"
                                                                    },
                                                                    {
                                                                        "prim": "IF",
                                                                        "args": [
                                                                            [
                                                                                {
                                                                                    "prim": "PUSH",
                                                                                    "args": [
                                                                                        {
                                                                                            "prim": "string"
                                                                                        },
                                                                                        {
                                                                                            "string": "ITEM_IS_FROZEN"
                                                                                        }
                                                                                    ]
                                                                                },
                                                                                {
                                                                                    "prim": "FAILWITH"
                                                                                }
                                                                            ],
                                                                            [
                                                                                {
                                                                                    "prim": "PUSH",
                                                                                    "args": [
                                                                                        {
                                                                                            "prim": "unit"
                                                                                        },
                                                                                        {
                                                                                            "prim": "Unit"
                                                                                        }
                                                                                    ]
                                                                                }
                                                                            ]
                                                                        ]
                                                                    }
                                                                ]
                                                            ]
                                                        },
                                                        { "prim": "DROP" },
                                                        { "prim": "DUP" },
                                                        { "prim": "CDR" },
                                                        { "prim": "CDR" },
                                                        { "prim": "NOW" },
                                                        { "prim": "SOME" },
                                                        { "prim": "PAIR" },
                                                        { "prim": "SWAP" },
                                                        { "prim": "CAR" },
                                                        { "prim": "PAIR" },
                                                        { "prim": "SWAP" },
                                                        { "prim": "DUP" },
                                                        {
                                                            "prim": "DUG",
                                                            "args": [
                                                                { "int": "2" }
                                                            ]
                                                        },
                                                        { "prim": "CDR" },
                                                        { "prim": "SWAP" },
                                                        { "prim": "DUP" },
                                                        {
                                                            "prim": "DUG",
                                                            "args": [
                                                                { "int": "2" }
                                                            ]
                                                        },
                                                        { "prim": "SOME" },
                                                        {
                                                            "prim": "DIG",
                                                            "args": [
                                                                { "int": "2" }
                                                            ]
                                                        },
                                                        { "prim": "CAR" },
                                                        { "prim": "CDR" },
                                                        { "prim": "CAR" },
                                                        { "prim": "UPDATE" },
                                                        { "prim": "SWAP" },
                                                        { "prim": "CAR" },
                                                        { "prim": "PAIR" }
                                                    ]
                                                ]
                                            },
                                            {
                                                "prim": "NIL",
                                                "args": [
                                                    { "prim": "operation" }
                                                ]
                                            },
                                            { "prim": "PAIR" }
                                        ],
                                        [
                                            { "prim": "SWAP" },
                                            { "prim": "DUP" },
                                            {
                                                "prim": "DUG",
                                                "args": [{ "int": "2" }]
                                            },
                                            { "prim": "CDR" },
                                            { "prim": "SWAP" },
                                            { "prim": "DUP" },
                                            {
                                                "prim": "DUG",
                                                "args": [{ "int": "2" }]
                                            },
                                            { "prim": "CAR" },
                                            { "prim": "CDR" },
                                            { "prim": "CAR" },
                                            { "prim": "GET" },
                                            {
                                                "prim": "IF_NONE",
                                                "args": [
                                                    [
                                                        { "prim": "DROP" },
                                                        {
                                                            "prim": "PUSH",
                                                            "args": [
                                                                {
                                                                    "prim": "string"
                                                                },
                                                                {
                                                                    "string": "ITEM_ID_DOESNT_EXIST"
                                                                }
                                                            ]
                                                        },
                                                        { "prim": "FAILWITH" }
                                                    ],
                                                    [
                                                        { "prim": "CDR" },
                                                        { "prim": "CAR" },
                                                        {
                                                            "prim": "IF_NONE",
                                                            "args": [
                                                                [
                                                                    {
                                                                        "prim": "PUSH",
                                                                        "args": [
                                                                            {
                                                                                "prim": "unit"
                                                                            },
                                                                            {
                                                                                "prim": "Unit"
                                                                            }
                                                                        ]
                                                                    }
                                                                ],
                                                                [
                                                                    {
                                                                        "prim": "NOW"
                                                                    },
                                                                    {
                                                                        "prim": "COMPARE"
                                                                    },
                                                                    {
                                                                        "prim": "GE"
                                                                    },
                                                                    {
                                                                        "prim": "IF",
                                                                        "args": [
                                                                            [
                                                                                {
                                                                                    "prim": "PUSH",
                                                                                    "args": [
                                                                                        {
                                                                                            "prim": "string"
                                                                                        },
                                                                                        {
                                                                                            "string": "ITEM_IS_FROZEN"
                                                                                        }
                                                                                    ]
                                                                                },
                                                                                {
                                                                                    "prim": "FAILWITH"
                                                                                }
                                                                            ],
                                                                            [
                                                                                {
                                                                                    "prim": "PUSH",
                                                                                    "args": [
                                                                                        {
                                                                                            "prim": "unit"
                                                                                        },
                                                                                        {
                                                                                            "prim": "Unit"
                                                                                        }
                                                                                    ]
                                                                                }
                                                                            ]
                                                                        ]
                                                                    }
                                                                ]
                                                            ]
                                                        },
                                                        { "prim": "DROP" },
                                                        { "prim": "SWAP" },
                                                        { "prim": "DUP" },
                                                        {
                                                            "prim": "DUG",
                                                            "args": [
                                                                { "int": "2" }
                                                            ]
                                                        },
                                                        { "prim": "CDR" },
                                                        { "prim": "SWAP" },
                                                        { "prim": "DUP" },
                                                        {
                                                            "prim": "DUG",
                                                            "args": [
                                                                { "int": "2" }
                                                            ]
                                                        },
                                                        { "prim": "SOME" },
                                                        {
                                                            "prim": "DIG",
                                                            "args": [
                                                                { "int": "2" }
                                                            ]
                                                        },
                                                        { "prim": "CAR" },
                                                        { "prim": "CDR" },
                                                        { "prim": "CAR" },
                                                        { "prim": "UPDATE" },
                                                        { "prim": "SWAP" },
                                                        { "prim": "CAR" },
                                                        { "prim": "PAIR" }
                                                    ]
                                                ]
                                            },
                                            {
                                                "prim": "NIL",
                                                "args": [
                                                    { "prim": "operation" }
                                                ]
                                            },
                                            { "prim": "PAIR" }
                                        ]
                                    ]
                                }
                            ]
                        ]
                    }
                ]
            ]
        }
    ],
    "source": "type item_metadata is record [\n    available_quantity: nat;\n    data: map (string, string);\n    item_id : nat;\n    name: string;\n    no_update_after: option (timestamp);\n    total_quantity: nat;\n]\n\ntype inventory_assign_parameter is record [\n    data: map (string, string);\n    instance_number: nat;\n    item_id: nat\n]\n\ntype inventory_parameter is\n    Assign_item of inventory_assign_parameter\n\ntype assign_parameter is address * nat * nat;\n\ntype parameter is \n    Add_item of item_metadata\n|   Assign_item_proxy of assign_parameter\n|   Update_item of item_metadata\n|   Freeze_item of nat\n\ntype storage is record [\n    owner: address;\n    version: string;\n    warehouse: big_map (nat, item_metadata);\n]\n\n[@inline] const ignore_item_metadata = [%Michelson ({| {DROP;UNIT} |} : item_metadata -> unit)]\n\ntype return is list (operation) * storage;\n\nfunction add (var item: item_metadata; var storage: storage): return is\n    block {\n        const found_item: option(item_metadata) = storage.warehouse [item.item_id];\n\n        case found_item of\n            None -> storage.warehouse := Big_map.add(item.item_id, item, storage.warehouse)\n        |   Some (i) -> block { ignore_item_metadata(i); failwith(\"ITEM_ID_ALREADY_EXISTS\")}\n        end;\n    } with ((nil: list (operation)), storage)\n\nfunction update (const item: item_metadata; var storage: storage): return is\n    block {\n        const found_item: option (item_metadata) = storage.warehouse [item.item_id];\n\n        case found_item of\n            None -> failwith(\"ITEM_ID_DOESNT_EXIST\")\n        |   Some (i) -> {\n                const no_update_after : option (timestamp) = i.no_update_after;\n\n                case no_update_after of\n                    None -> skip\n                |   Some (t) -> { \n                    if Tezos.now >= t then {\n                        failwith(\"ITEM_IS_FROZEN\");\n                    } else {\n                        skip;\n                    }\n                }\n                end;\n\n                storage.warehouse := Big_map.update(item.item_id, Some(item), storage.warehouse);\n        }\n        end;\n    } with ((nil: list (operation)), storage)\n\nfunction assign (const params: assign_parameter; var storage: storage): return is\n    block {\n        var ops : list (operation) := nil;\n        const found_item: option (item_metadata) = storage.warehouse[params.1];\n\n        case found_item of\n            None -> failwith(\"ITEM_DOESNT_EXIST\")\n            | Some (fi) -> {\n                const available_quantity : nat = fi.available_quantity;\n                const total_quantity : nat = fi.total_quantity;\n        \n                if available_quantity = 0n or params.2 > total_quantity then {\n                    failwith (\"NO_AVAILABLE_ITEM\");\n                } else {\n                    const inventory : contract (inventory_parameter) =\n                        case (Tezos.get_entrypoint_opt(\"%assign_item\", params.0) : option (contract (inventory_parameter))) of\n                            Some (contract) -> contract\n                            | None -> (failwith (\"CONTRACT_NOT_FOUND\") : contract (inventory_parameter))\n                        end;\n\n                    const action : inventory_parameter = Assign_item (record [\n                        data = fi.data;\n                        instance_number = params.2;\n                        item_id = params.1;\n                    ]);\n\n                    const op : operation = Tezos.transaction (action, 0tez, inventory);\n                    ops := list [op];\n\n                    const updated_fi = fi with record [ available_quantity = abs (fi.available_quantity - 1n) ];\n                    storage.warehouse[params.1] := updated_fi\n                }\n            }\n        end;\n    } with (ops, storage)\n\nfunction freeze (const id: nat; var storage: storage): return is\n    block {\n        const found_item: option (item_metadata) = storage.warehouse [id];\n\n        case found_item of \n            None -> failwith(\"ITEM_ID_DOESNT_EXIST\")\n        |   Some (i) -> {\n                const no_update_after : option (timestamp) = i.no_update_after;\n\n                case no_update_after of\n                    None -> skip\n                |   Some(t) -> {\n                    if Tezos.now >= t then {\n                        failwith(\"ITEM_IS_FROZEN\");\n                    } else {\n                        skip;\n                    }\n                }\n                end;\n\n                i.no_update_after := Some(Tezos.now);\n                storage.warehouse := Big_map.update(i.item_id, Some(i), storage.warehouse);\n        }\n        end;\n    } with ((nil: list (operation)), storage)\n\nfunction main (const action : parameter; const storage : storage): return is\n    case action of\n        Add_item (i) -> add(i, storage)\n    |   Assign_item_proxy (ap) -> assign(ap, storage)\n    |   Update_item (i) -> update(i, storage)\n    |   Freeze_item (id) -> freeze(id, storage)\n    end\n",
    "compiler": { "name": "ligo", "version": "next" },
    "schemaVersion": "3.2.0-tezos.1",
    "updatedAt": "2021-05-01T20:21:09.082Z"
}
