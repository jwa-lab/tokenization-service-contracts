{
    "contractName": "Inventory",
    "michelson": [
        {
            "prim": "parameter",
            "args": [
                {
                    "prim": "or",
                    "args": [
                        {
                            "prim": "pair",
                            "args": [
                                {
                                    "prim": "pair",
                                    "args": [
                                        {
                                            "prim": "map",
                                            "args": [
                                                { "prim": "string" },
                                                { "prim": "string" }
                                            ],
                                            "annots": ["%data"]
                                        },
                                        {
                                            "prim": "nat",
                                            "annots": ["%instance_number"]
                                        }
                                    ]
                                },
                                { "prim": "nat", "annots": ["%item_id"] }
                            ],
                            "annots": ["%assign_item"]
                        },
                        {
                            "prim": "pair",
                            "args": [
                                {
                                    "prim": "pair",
                                    "args": [
                                        {
                                            "prim": "map",
                                            "args": [
                                                { "prim": "string" },
                                                { "prim": "string" }
                                            ],
                                            "annots": ["%data"]
                                        },
                                        {
                                            "prim": "nat",
                                            "annots": ["%instance_number"]
                                        }
                                    ]
                                },
                                { "prim": "nat", "annots": ["%item_id"] }
                            ],
                            "annots": ["%update_item"]
                        }
                    ]
                }
            ]
        },
        {
            "prim": "storage",
            "args": [
                {
                    "prim": "big_map",
                    "args": [
                        { "prim": "nat" },
                        {
                            "prim": "map",
                            "args": [
                                { "prim": "nat" },
                                {
                                    "prim": "map",
                                    "args": [
                                        { "prim": "string" },
                                        { "prim": "string" }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        },
        {
            "prim": "code",
            "args": [
                [
                    { "prim": "UNPAIR" },
                    {
                        "prim": "IF_LEFT",
                        "args": [
                            [
                                { "prim": "SWAP" },
                                { "prim": "DUP" },
                                { "prim": "DUG", "args": [{ "int": "2" }] },
                                { "prim": "SWAP" },
                                { "prim": "DUP" },
                                { "prim": "DUG", "args": [{ "int": "2" }] },
                                { "prim": "CDR" },
                                { "prim": "GET" },
                                {
                                    "prim": "IF_NONE",
                                    "args": [
                                        [
                                            { "prim": "SWAP" },
                                            {
                                                "prim": "EMPTY_MAP",
                                                "args": [
                                                    { "prim": "nat" },
                                                    {
                                                        "prim": "map",
                                                        "args": [
                                                            {
                                                                "prim": "string"
                                                            },
                                                            { "prim": "string" }
                                                        ]
                                                    }
                                                ]
                                            },
                                            {
                                                "prim": "DUP",
                                                "args": [{ "int": "3" }]
                                            },
                                            { "prim": "CAR" },
                                            { "prim": "CAR" },
                                            {
                                                "prim": "DUP",
                                                "args": [{ "int": "4" }]
                                            },
                                            { "prim": "CAR" },
                                            { "prim": "CDR" },
                                            { "prim": "SWAP" },
                                            { "prim": "SOME" },
                                            { "prim": "SWAP" },
                                            { "prim": "UPDATE" },
                                            {
                                                "prim": "DIG",
                                                "args": [{ "int": "2" }]
                                            },
                                            { "prim": "CDR" },
                                            { "prim": "SWAP" },
                                            { "prim": "SOME" },
                                            { "prim": "SWAP" },
                                            { "prim": "UPDATE" }
                                        ],
                                        [
                                            {
                                                "prim": "DIG",
                                                "args": [{ "int": "2" }]
                                            },
                                            { "prim": "SWAP" },
                                            {
                                                "prim": "DUP",
                                                "args": [{ "int": "3" }]
                                            },
                                            { "prim": "CAR" },
                                            { "prim": "CAR" },
                                            {
                                                "prim": "DUP",
                                                "args": [{ "int": "4" }]
                                            },
                                            { "prim": "CAR" },
                                            { "prim": "CDR" },
                                            { "prim": "SWAP" },
                                            { "prim": "SOME" },
                                            { "prim": "SWAP" },
                                            { "prim": "UPDATE" },
                                            {
                                                "prim": "DIG",
                                                "args": [{ "int": "2" }]
                                            },
                                            { "prim": "CDR" },
                                            { "prim": "SWAP" },
                                            { "prim": "SOME" },
                                            { "prim": "SWAP" },
                                            { "prim": "UPDATE" }
                                        ]
                                    ]
                                },
                                {
                                    "prim": "NIL",
                                    "args": [{ "prim": "operation" }]
                                },
                                { "prim": "PAIR" }
                            ],
                            [
                                { "prim": "SWAP" },
                                { "prim": "DUP" },
                                { "prim": "DUG", "args": [{ "int": "2" }] },
                                { "prim": "SWAP" },
                                { "prim": "DUP" },
                                { "prim": "DUG", "args": [{ "int": "2" }] },
                                { "prim": "CDR" },
                                { "prim": "GET" },
                                {
                                    "prim": "IF_NONE",
                                    "args": [
                                        [
                                            { "prim": "DROP" },
                                            {
                                                "prim": "PUSH",
                                                "args": [
                                                    { "prim": "string" },
                                                    {
                                                        "string": "NO_SUCH_ITEM_IN_INVENTORY"
                                                    }
                                                ]
                                            },
                                            { "prim": "FAILWITH" }
                                        ],
                                        [
                                            { "prim": "DUP" },
                                            {
                                                "prim": "DUP",
                                                "args": [{ "int": "3" }]
                                            },
                                            { "prim": "CAR" },
                                            { "prim": "CDR" },
                                            { "prim": "GET" },
                                            {
                                                "prim": "IF_NONE",
                                                "args": [
                                                    [
                                                        {
                                                            "prim": "DROP",
                                                            "args": [
                                                                { "int": "2" }
                                                            ]
                                                        },
                                                        {
                                                            "prim": "PUSH",
                                                            "args": [
                                                                {
                                                                    "prim": "string"
                                                                },
                                                                {
                                                                    "string": "NO_SUCH_INSTANCE_NUMBER"
                                                                }
                                                            ]
                                                        },
                                                        { "prim": "FAILWITH" }
                                                    ],
                                                    [
                                                        { "prim": "DROP" },
                                                        {
                                                            "prim": "DIG",
                                                            "args": [
                                                                { "int": "2" }
                                                            ]
                                                        },
                                                        { "prim": "SWAP" },
                                                        {
                                                            "prim": "DUP",
                                                            "args": [
                                                                { "int": "3" }
                                                            ]
                                                        },
                                                        { "prim": "CAR" },
                                                        { "prim": "CAR" },
                                                        { "prim": "SOME" },
                                                        {
                                                            "prim": "DUP",
                                                            "args": [
                                                                { "int": "4" }
                                                            ]
                                                        },
                                                        { "prim": "CAR" },
                                                        { "prim": "CDR" },
                                                        { "prim": "UPDATE" },
                                                        {
                                                            "prim": "DIG",
                                                            "args": [
                                                                { "int": "2" }
                                                            ]
                                                        },
                                                        { "prim": "CDR" },
                                                        { "prim": "SWAP" },
                                                        { "prim": "SOME" },
                                                        { "prim": "SWAP" },
                                                        { "prim": "UPDATE" }
                                                    ]
                                                ]
                                            }
                                        ]
                                    ]
                                },
                                {
                                    "prim": "NIL",
                                    "args": [{ "prim": "operation" }]
                                },
                                { "prim": "PAIR" }
                            ]
                        ]
                    }
                ]
            ]
        }
    ],
    "source": "type item_data is record [\n    data: map (string, string);\n]\n\ntype item_instances is map(nat, item_data)\n\ntype storage is record [\n    inventory: big_map (nat, item_instances);\n]\n\ntype parameter is record [\n    data: item_data;\n    instance_number: nat;\n    item_id: nat\n]\n\ntype action is \n    Assign_item of parameter\n|   Update_item of parameter\n\n[@inline] const ignore_item_data = [%Michelson ({| {DROP;UNIT} |} : item_data -> unit)]\n\ntype return is list (operation) * storage;\n\nfunction assign_item (const params: parameter; const storage: storage): return is\n    block {\n        const instances_map: option (item_instances) = storage.inventory[params.item_id];\n\n        case instances_map of\n            None -> block {\n                const new_instances_map : item_instances = map [params.instance_number -> params.data];\n\n                storage.inventory := Big_map.add(params.item_id, new_instances_map, storage.inventory)\n            }\n            | Some(im) -> block {\n                im := Map.add(params.instance_number, params.data, im);\n\n                storage.inventory := Big_map.add(params.item_id, im, storage.inventory)\n            }\n        end;\n    } with ((nil: list (operation)), storage)\n\nfunction update_item (const params: parameter; const storage: storage): return is\n    block {\n        const instances_map: option (item_instances) = storage.inventory[params.item_id];\n\n        case instances_map of\n            None -> failwith(\"NO_SUCH_ITEM_IN_INVENTORY\")\n            | Some (im) -> block {\n                const instance: option (item_data) = im [params.instance_number];\n\n                case instance of\n                    None -> failwith(\"NO_SUCH_INSTANCE_NUMBER\")\n                |   Some (i) -> block {\n                    ignore_item_data(i);\n                    const updated_im : item_instances = Map.update(params.instance_number, Some (params.data), im);\n                    storage.inventory [params.item_id] := updated_im\n                }\n                end;\n            }\n        end;\n    } with ((nil: list (operation)), storage)\n\nfunction main (const action: action; const storage: storage): return is\n    case action of\n        Assign_item (i) -> assign_item(i, storage)\n    |   Update_item (i) -> update_item(i, storage)\n    end\n",
    "compiler": { "name": "ligo", "version": "next" },
    "schemaVersion": "3.2.0-tezos.1",
    "updatedAt": "2021-05-01T20:21:09.081Z"
}
